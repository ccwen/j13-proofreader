{
  "version": 3,
  "sources": [
    "../Users/cheahshen/AppData/Roaming/npm/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "j13-proofreader/index.js",
    "j13-proofreader/src/controls.js",
    "j13-proofreader/src/main.js",
    "j13-proofreader/src/preview.js",
    "j13-proofreader/src/rule.js",
    "node_modules/ksana2015-proofreader/fileio.js",
    "node_modules/ksana2015-proofreader/index.js",
    "node_modules/ksana2015-proofreader/model.js",
    "node_modules/ksana2015-proofreader/node/readdirmeta.js",
    "node_modules/ksana2015-proofreader/pdfviewer.js",
    "node_modules/ksana2015-proofreader/react-pdf.js",
    "node_modules/ksana2015-proofreader/rpc/rpc.js",
    "node_modules/ksana2015-proofreader/rpc/rpc_fs.js",
    "node_modules/ksana2015-proofreader/rpc/rpc_util.js",
    "node_modules/ksana2015-proofreader/rule.js",
    "node_modules/ksana2015-proofreader/socketfs.js",
    "node_modules/ksana2015-webruntime/downloader.js",
    "node_modules/ksana2015-webruntime/html5fs.js",
    "node_modules/ksana2015-webruntime/ksanagap.js",
    "node_modules/ksana2015-webruntime/livereload.js",
    "node_modules/ksana2015-webruntime/mkdirp.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nif(window.location.origin.indexOf(\"//127.0.0.1\")>-1) {\r\n\trequire(\"ksana2015-webruntime/livereload\")(); \r\n}\r\nvar ksanagap=require(\"ksana2015-webruntime/ksanagap\");\r\nksanagap.boot(\"j13-proofreader\",function(){\r\n\tvar Main=React.createElement(require(\"./src/main\"));\r\n\tksana.mainComponent=ReactDOM.render(Main,document.getElementById(\"main\"));\r\n});",
    "const React=require(\"react\");\r\n\r\nconst E=React.createElement;\r\nconst PT=React.PropTypes;\r\nconst markupButtons=React.createClass({displayName: \"markupButtons\",\r\n\tcontextTypes:{\r\n    action:PT.func,\r\n    getter:PT.func,\r\n    listen:PT.func\r\n\t}\t\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{},\r\n\t\t\tE(\"button\",{onClick:this.props.togglePreview},\"preview\")\r\n\t\t)\t\r\n\t}\r\n});\r\nvar loadSaveButtons=React.createClass({displayName: \"loadSaveButtons\",\r\n\tcontextTypes:{\r\n    \taction:PT.func,\r\n    \tgetter:PT.func,\r\n    \tlisten:PT.func,\r\n    \tunlistenAll:PT.func\r\n\t}\r\n\t,getInitialState:function(){\r\n\t\tvar fn=localStorage.getItem(\"j13_workingfn\")||\"j13.txt\";\r\n\t\tvar starttime=new Date();\r\n\t\treturn {fn,starttime};\r\n\t}\r\n\t,componentDidMount:function(){\r\n\t\tsetTimeout(this.loadfile,1000);\r\n\t\tthis.context.listen(\"savefile\",this.savefile,this);\t\t\r\n\t\tthis.timer=setInterval(this.updatetimer,10000);\r\n\t}\r\n\t,componentWillUnmount:function(){\r\n\t\tthis.context.unlistenAll(this);\r\n\t\tclearInterval(this.timer);\r\n\t}\r\n\t,loadfile:function(){\r\n\t\tvar action=this.context.action;\r\n\t\tvar fn=this.state.fn;\r\n\t\tthis.setState({starttime:new Date(),elapse:0});\r\n\t\tthis.context.getter(\"file\",this.state.fn,function(data){\r\n\t\t\taction(\"loaded\",data);\r\n\t\t\tlocalStorage.setItem(\"j13_workingfn\",fn);\r\n\t\t});\r\n\t}\r\n\t,loadnextfile:function(){\r\n\t\tvar fn=this.state.fn.replace(/\\d+/,function(m){\r\n\t\t\treturn parseInt(m)+1;\r\n\t\t});\r\n\t\tthis.setState({fn},function(){\r\n\t\t\tthis.loadfile();\r\n\t\t}.bind(this));\r\n\t}\r\n\t,savefile:function(){\r\n\t\tif (!this.props.dirty)return;\r\n\t\t\r\n\t\tvar action=this.context.action;\r\n\t\tvar content=this.context.getter(\"getcontent\");\r\n\t\tthis.context.getter(\"save\",{fn:this.state.fn,content},function(err){\r\n\t\t\taction(\"saved\");\r\n\t\t});\r\n\t}\r\n\t,onInput:function(e){\r\n\t\tthis.setState({fn:e.target.value});\r\n\t}\r\n\t,onKeyPress:function(e){\r\n\t\tif (e.key==\"Enter\"){\r\n\t\t\tthis.loadfile();\r\n\t\t}\r\n\t}\r\n\t,updatetimer:function(){\r\n\t\tthis.setState({elapse: Math.floor((new Date()-this.state.starttime)/1000) });\r\n\t}\r\n\t,render:function(){\r\n\t\tif (this.props.preview)return E(\"span\");\r\n\t\treturn E(\"div\",{},\r\n\t\t\tE(\"button\",{onClick:this.loadfile,disabled:this.props.dirty},\"load\"),\r\n\t\t\tE(\"input\",{size:8,onKeyPress:this.onKeyPress,\r\n\t\t\t\t\tvalue:this.state.fn,onChange:this.onInput,disabled:this.props.dirty}),\r\n\t\t\tE(\"button\",{onClick:this.savefile,disabled:!this.props.dirty},\"save\"),\r\n\t\t\tE(\"span\",{style:styles.elapse},this.state.elapse,\"secs\")\r\n\t\t)\t\r\n\t}\r\n});\r\n\r\nvar Controls=React.createClass({displayName: \"Controls\",\r\n\tcontextTypes:{\r\n\t\tgetter:PT.func,\r\n    listen:PT.func,\r\n    unlistenAll:PT.func\r\n\t}\r\n\t,getInitialState:function(){\r\n\t\treturn {note:\"\"};\r\n\t}\r\n\t,componentDidMount:function(){\r\n\t\tthis.context.listen(\"footnote\",this.footnote,this);\t\t\r\n\t}\r\n\t,componentWillUnmount:function(){\r\n\t\tthis.context.unlistenAll(this);\r\n\t}\r\n\t,footnote:function(note){\r\n\t\tthis.setState({note});\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{style:{right:20,width:200,zIndex:100,\r\n\t\t\tbackground:\"silver\",position:\"absolute\"}},\r\n\t\t\tE(\"div\",{},E(\"span\",{style:styles.note},this.props.helpmessage)),\t\r\n\t\t\tE(loadSaveButtons,this.props),E(markupButtons,{togglePreview:this.props.togglePreview}),\r\n\t\t\tE(\"div\",{},E(\"span\",{style:styles.note},this.state.note))\r\n\t\t);\r\n\t}\r\n})\r\nvar styles={\r\n\tnote:{fontSize:\"50%\"},\r\n\twarnings:{fontSize:\"50%\"},\r\n\telapse:{fontSize:\"50%\"}\r\n}\r\n/*\r\n  HOT KEY for next error\r\n\r\n*/\r\nmodule.exports=Controls;\r\n",
    "const React=require(\"react\");\r\nconst ReactDOM=require(\"react-dom\");\r\nconst CodeMirror=require(\"ksana-codemirror\").Component;\r\nconst E=React.createElement;\r\nconst PT=React.PropTypes;\r\nconst styles={image:{height:\"100%\"}};\r\nconst Controls=require(\"./controls\");\r\nconst Preview=require(\"./preview\");\r\nconst rule=require(\"./rule\");\r\nconst {setRule,fileio,PDFViewer}=require(\"ksana2015-proofreader\");\r\nconst {listen,unlistenAll,action,getter,registerGetter,unregisterGetter}=require(\"ksana2015-proofreader\").model;\r\n\r\nconst Maincomponent = React.createClass({displayName: \"Maincomponent\",\r\n\tgetInitialState:function() {\r\n\t//\tvar m=new Magnifier();\r\n\t\tsetRule(rule);\r\n\t\treturn {data:\"\",pageid:rule.initpage,dirty:false,warningcount:0\r\n\t\t,pdffn:\"\",page:0,preview:null};\r\n\t}\r\n\t,prevline:-1\r\n  ,childContextTypes: {\r\n    listen: PT.func\r\n    ,unlistenAll: PT.func\r\n    ,action: PT.func\r\n    ,getter: PT.func\r\n    ,registerGetter:PT.func\r\n    ,unregisterGetter:PT.func\r\n  }\r\n  ,getChildContext:function(){\r\n    return {action,listen,unlistenAll,getter,registerGetter,unregisterGetter};\r\n  }\r\n\t,componentWillMount:function(){\r\n\t\tfileio.init();\r\n\t\tlisten(\"loaded\",this.loaded,this);\r\n\t\tlisten(\"saved\",this.saved,this);\r\n\t\tlisten(\"nextwarning\",this.nextwarning,this);\r\n\t\tlisten(\"pinpoint\",this.pinpoint,this);\r\n\t\tregisterGetter(\"getcontent\",this.getcontent);\r\n\t\tregisterGetter(\"setcontent\",this.setcontent);\r\n\t\tregisterGetter(\"getpagetext\",this.getPageText);\r\n\t}\r\n\t,getPageStartIndex:function(pageid){\r\n\t\tconst start=\"~\"+pageid||this.state.pageid;\r\n\t\tvar index=this.getcontent().indexOf(start);\r\n\t\treturn index;\r\n\t}\r\n\t,getPageText:function(){\r\n\t\tconst content=this.getcontent();\r\n\t\tconst start=\"~\"+this.state.pageid;\r\n\t\tvar from=content.indexOf(start);\r\n\t\tfrom+=start.length+1;\r\n\t\tvar to=content.indexOf(\"~\",from+1);\r\n\t\tif (to==-1) to=content.length; \r\n\t\treturn content.substring(from,to);\r\n\t}\r\n\t,componentWillUnmount:function(){\r\n\t\tunregisterGetter(\"getcontent\");\r\n\t\tunregisterGetter(\"setcontent\");\r\n\t\tunregisterGetter(\"getpagetext\");\r\n\t\tunlistenAll(this);\r\n\t}\r\n\t,pinpoint:function(index){\r\n\t\tconst pageid=this.state.pageid;\r\n\t\tthis.setState({preview:null},()=>{\r\n\t\t\tthis.prepareCM(this.getPageStartIndex(pageid)+index);\r\n\t\t});\r\n\t}\r\n\t,goto:function(index){\r\n\t\tif (!index)return;\r\n\t\tvar pos=this.cm.posFromIndex(index);\r\n\t\tthis.cm.scrollIntoView(pos,400);\r\n\t\tsetTimeout(()=>{\r\n\t\t\tthis.cm.doc.setCursor(pos);\r\n\t\t\tthis.cm.focus();\r\n\t\t\tthis.cm.doc.markText(pos,{line:pos.line,ch:pos.ch+1},\r\n\t\t\t{className:\"pinpoint\",clearOnEnter:true});\r\n\t\t},500);\r\n\t}\r\n\t,prepareCM:function(index){\r\n\t\tthis.cm=this.refs.cm.getCodeMirror();//codemirror instance\r\n\t\trule.setHotkeys(this.cm);\r\n\t\tthis.doc=this.cm.getDoc();\r\n\r\n\t\trule.setDoc(this.doc);\r\n\t\trule.markAllLine();\r\n\t\tthis.goto(index);\r\n\t}\r\n\t,componentDidMount:function(){\r\n\t\tthis.prepareCM();\r\n\t}\r\n\t,getcontent:function(){\r\n\t\treturn this.refs.cm.getCodeMirror().getValue();\r\n\t}\r\n\t,setcontent:function(content){\r\n\t\tthis.refs.cm.getCodeMirror().setValue(content);\r\n\t\tif (!this.state.dirty) this.setState({dirty:true});\r\n\t\trule.markAllLine();\r\n\t}\r\n\t,loaded:function(data){\r\n\t\tthis.setState({data,dirty:false});\r\n\t\trule.markAllLine();\r\n\t\tsetTimeout(function(){\r\n\t\t\tthis.onChange();//trigger validator\r\n\t\t}.bind(this),500);\r\n\t}\r\n\t,saved:function(){\r\n\t\tthis.setState({dirty:false});\r\n\t}\r\n\t,nextwarning:function(){//jump to next warning\r\n\t\tvar pos=this.cm.getCursor();\r\n\t\tvar next=rule.nextWarning(pos.line);\r\n\t\tthis.cm.scrollIntoView({line:next+5,ch:0});\r\n\t\tthis.doc.setCursor({line:next,ch:0});\r\n\t}\r\n\t,onCursorActivity:function(cm) {\r\n\t\tvar pos=cm.getCursor();\r\n\t\tvar pageid=rule.getPageByLine(pos.line);\r\n\r\n\t\tif (pos.line!==this.prevline) {\r\n\t\t\tif (this.prevline>-1) rule.markLine(this.prevline,true);\r\n\t\t\tif (this.state.pageid!==pageid) {\r\n\t\t\t\tvar m=rule.getPDFPage(pageid);\r\n\t\t\t\tif (m) this.setState({pdffn:m.pdffn,page:m.page,pageid});\r\n\t\t\t\telse this.setState({pageid});\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar index=cm.indexFromPos(pos);\r\n\t\tvar str=cm.getValue().substr(index-5,10);\r\n\t\tvar footnote=rule.getFootnote(str,pageid);\r\n\t\taction(\"footnote\",footnote);\r\n\t\tthis.prevline=pos.line;\r\n\t}\r\n\t,onChange:function(){\r\n\t\tif (!this.state.dirty && this.doc.getValue()!==this.state.data) {//setcontent will trigger onchange\r\n\t\t\tthis.setState({dirty:true});\r\n\t\t}\r\n\r\n\t\tclearTimeout(this.timer1);\r\n\t\tthis.timer1=setTimeout(function(){\r\n\t\t\tvar warningcount=rule.validateMark(this.doc.getValue());\t\r\n\t\t\tthis.setState({warningcount});\r\n\t\t}.bind(this),500);\r\n\t}\r\n\t,onBeforeChange:function(cm,co){\r\n\t\trule.onBeforeChange(cm,co);\r\n\t}\r\n\t,togglePreview:function(){\r\n\t\tif (this.state.preview) {\r\n\t\t\tthis.setState({preview:null},()=>this.prepareCM())\r\n\t\t} else {\r\n\t\t\tconst preview=this.getPageText();\r\n\t\t\tconst data=this.getcontent();//get content from editor and save in state\r\n\t\t\tthis.setState({preview,data});\r\n\t\t}\r\n\t}\t\r\n\t,TextViewer:function(){\r\n\t\tif (this.state.preview){\r\n\t\t\treturn E(Preview,{data:this.state.preview});\r\n\t\t} else {\r\n\t\t\treturn E(CodeMirror,{ref:\"cm\",value:this.state.data,\r\n\t      \t\tonChange:this.onChange,\r\n\t      \t\tonBeforeChange:this.onBeforeChange,\r\n  \t    \t\tonCursorActivity:this.onCursorActivity});\r\n\t\t}\r\n\t}\r\n  ,render: function() {\r\n  \treturn E(\"div\",{},E(Controls,{dirty:this.state.dirty,\r\n  \t\tpreview:!!this.state.preview,\r\n  \t\twarnings:this.state.warningcount+\" warnings\"\r\n  \t\t,togglePreview:this.togglePreview\r\n  \t\t,helpmessage:rule.helpmessage}),\r\n    \tE(\"div\",{style:{display:\"flex\",flexDirection:\"row\"}},\r\n      \tE(\"div\",{style:{flex:2}},\r\n    \t\t\tE(PDFViewer,{ref:\"pdf\", style:styles.image,rwidth:2/5,\r\n    \t\t\t\tpage:this.state.page,pdffn:this.state.pdffn,scale:1.4})\r\n    \t\t\t)\r\n    \t\t,E(\"div\",{style:{flex:3}},this.TextViewer())\r\n    \t )\r\n    \t)\r\n  }\r\n});\r\n\r\nmodule.exports=Maincomponent;\r\n",
    "/* kangxi preview*/\r\nconst React=require(\"react\");\r\nconst ReactDOM=require(\"react-dom\");\r\nconst E=React.createElement;\r\nconst PT=React.PropTypes;\r\n\r\nconst Preview=React.createClass({displayName: \"Preview\",\r\n\tgetInitialState:function(){\r\n\t\tconst parts=this.parseText(this.props.data);\r\n\t\treturn {parts};\r\n/*\r\n\t\treturn {parts:[\r\n\t\t\t\t[\"z\",\"林傳韓生推詩之意而爲內外傳數萬言其語頗與齊魯閒殊然其歸一也\"+\r\n\"　又少也顏延之庭誥文選書務一不尚煩密何承天答顏永嘉書竊願吾子舍兼而遵一也\"+\r\n\"　又增韻純也易繫辭天下之動貞夫一老子道德經天得一以淸地得一以寧\"],\r\n\t\t\t\t\r\n\t\t\t\t[\"br\"],\r\n\t\t\t\t[\"wh\",\"一\"],\r\n\t\t\t\t[\"an\"],\r\n\t\t\t\t[\"wh\",\"弌\"],\r\n\t\t\t\t[\"z\",\"唐韻韻會於悉切集韻正韻益悉切𡘋漪入聲\"\r\n\t\t\t\t+\"說文惟初大始道立於一造分天地化成萬物廣韻數之始也\"\r\n\t\t\t\t+\"物之極也易繫辭天一地二老子道德經道生一一生二　\"\r\n\t\t\t\t+\"又廣韻同也禮樂記禮樂𠛬政其極一也史記儒\"],\r\n\t\t\t\t\r\n\t\t\t\t[\"br\"],\r\n\t\t\t\t[\"wh\",\"　　一部\"],\r\n\t\t\t\t\r\n\t\t\t\t[\"br\"],\r\n\t\t\t\t[\"wh\",\"　子集上\" ],\r\n\t\t\t\t\r\n\t\t\t\t[\"br\"],\r\n\t\t\t\t[\"wh\",\"康熙字典\"]\r\n\r\n\t\t\t]}\r\n*/\r\n\t}\r\n\t,contextTypes:{\r\n\t\taction:PT.func\r\n\t}\r\n\t,isNonChar:function(code){\r\n\t\tif (code>=0x3000&&code<=0x303f) return true;//cjk puncuation\r\n\t\tif (code<0x7f) return true;\r\n\t\tif (code>=0xff00&&code<=0xff9f) return true;//full width\r\n\t\treturn false;\r\n\t}\r\n\t,getTextFirstCh:function(str,count){\r\n\t\tvar i=0;\r\n\t\twhile (i<str.length && count){\r\n\t\t\tconst code=str.charCodeAt(i);\r\n\t\t\tif (code>=0xd800&&code<=0xd900) i++;\r\n\t\t\telse if (str[i]==\"&\") {\r\n\t\t\t\twhile (i<str.length) {\r\n\t\t\t\t\tif (str[i]==\";\") break;\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t} else if (this.isNonChar(code)){\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\r\n\t\t\ti++;count--;\r\n\t\t}\r\n\t\treturn str.substr(0,i);\r\n\t}\r\n\t,chcount:function(str){\r\n\t\tvar i=0,c=0;\r\n\t\twhile (i<str.length){\r\n\t\t\tconst code=str.charCodeAt(i);\r\n\t\t\tif (code>=0xd800&&code<=0xd900) i++;\r\n\t\t\telse if (str[i]==\"&\") {\r\n\t\t\t\twhile (i<str.length) {\r\n\t\t\t\t\tif (str[i]==\";\") break;\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t} else if (this.isNonChar(code)){\r\n\t\t\t\tc--;\r\n\t\t\t}\r\n\t\t\ti++;c++;\r\n\t\t}\r\n\t\treturn c;\r\n\t}\r\n\r\n\t,parseText:function(str){\r\n\t\tvar lines=str.split(\"\\n\");\r\n\t\tvar parts=[],part,offset=0,i,linestart=[],linecount=0;\r\n\t\tconst getZ=function(z){\r\n\t\t\tz=z.replace(/[─「」，、．；《》：。〈〉\\n]/g,\"\");\r\n\t\t\tz=z.replace(/\\^\\d+.+/g,\"\");\r\n\t\t\treturn z;\r\n\t\t}\r\n\t\tvar start;\r\n\t\tfor (i=lines.length-1;i>=0;i--) {\r\n\t\t\tconst z=getZ(lines[i]);\r\n\t\t\tif (!z) continue;\r\n\t\t\tparts.push([\"text\",z,start]);\r\n\t\t\tstart+=lines[i].length;\r\n\t\t\tparts.push([\"br\"]);\r\n\t\t}\r\n\t\r\n\r\n\t\treturn parts;\r\n\t}\r\n\t,renderPart:function(part){\r\n\t\tvar out=[];\r\n\t\tconst type=part[0],text=part[1],start=part[2];\r\n\t\tvar cls={\"data-start\":start};\r\n\t\tif (type===\"br\") {\r\n\t\t\tout.push(E(\"br\"));\r\n\t\t} else {\r\n\t\t\tout.push(E(\"span\",{className:\"vertical\"},text));\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\t,onmousemove:function(e){\r\n\t\tconst ruler=ReactDOM.findDOMNode(this.refs.ruler);\r\n\t\r\n\t\truler.style.top=e.clientY+3;//make sure the underlay is clickable\r\n\t}\r\n\t,guestCharPos:function(cheight,x,y,w,h,side){\r\n\t\tconst ccount=h/cheight;\r\n\t\tvar c=Math.floor((y/h) * ccount);\r\n\t\tif (side) c+=ccount;\r\n\t\treturn c;\r\n\t}\r\n\t,guestCharHeight:function(str,h){\r\n\t\tvar count=this.chcount(str);\r\n\t\tif (count%2==1)count++;//z always has even number\r\n\t\treturn (h/count);\r\n\t}\r\n\t,onclick:function(e){\r\n\t\tvar nod=e.target;\r\n\t\tconst side=nod.className.indexOf(\"left\")>-1?1:0;\r\n\t\tconst cheight=this.guestCharHeight(nod.innerText,nod.offsetHeight);\r\n\r\n\t\tif (!nod.dataset.start) nod=nod.parentElement;\r\n\r\n\t\tconst ch=this.guestCharPos(cheight,e.clientX-nod.offsetLeft,\r\n\t\t\te.clientY-nod.offsetTop,nod.offsetWidth,nod.offsetHeight,side);\r\n\r\n\t\tconst start=parseInt(nod.dataset.start,10);\r\n\t\tconst text=this.props.data.substr(start);\r\n\t\tconst chpos=this.getTextFirstCh(text,ch+2).length;\r\n\t\tthis.context.action(\"pinpoint\",start+chpos);\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{className:\"v\"},\r\n\t\t\tE(\"div\",{className:\"ruler\",ref:\"ruler\"}),\r\n\t\t\tE(\"div\",{onMouseMove:this.onmousemove,onClick:this.onclick}\r\n\t\t\t\t,this.state.parts.map(this.renderPart)) \r\n\t\t);\r\n\t}\r\n});\r\nmodule.exports=Preview;",
    "/*\r\nusable prefix\r\n@\r\n$\r\n%\r\n*\r\n+\r\n# foot note\r\n~ page break\r\n^ paragraph\r\n*/\r\n/* convert simple markup to tag */\r\n/* give warning for */\r\nvar PBLINE=[];\r\nvar initpage=\"1.1\";\r\nconst fs=require(\"ksana2015-proofreader\").socketfs;\r\nvar doc=null;\r\nvar footnote=null;\r\nconst {action}=require(\"ksana2015-proofreader\").model;\r\n\r\nvar getPDFPage=function(pageid) {\r\n\tif (!pageid)return;\r\n\tvar m=pageid.match(/(\\d+)\\.(\\d+)/);\r\n\tif (!m)return ;\r\n\r\n\tconst page=parseInt(m[2],10)+2;\r\n\tconst fn=parseInt(m[1],10);\r\n\r\n\tvar pdffn=\"pdf/\"+fn+\".pdf\";\r\n\treturn {pdffn,page};\r\n}\r\nvar init=function(){\r\n\tfs.setDataroot(\"j13-corpus/\")\t;\r\n}\r\nvar onTagClick=function(e) {\r\n\t\tvar marker=e.target.marker;\r\n\t\tvar pos=marker.find();\r\n\t\tdoc.setCursor(pos.to);\r\n\t\tdoc.cm.focus();\r\n\t\tmarker.clear();\r\n}\r\nvar createMarker=function(classname,tag) {\r\n\t\tvar element=document.createElement(\"SPAN\");\r\n\t\telement.className=classname;\r\n\t\telement.innerHTML=tag;\r\n\t\telement.onclick=onTagClick;\r\n\t\treturn element;\r\n}\r\n\r\nvar markLine=function(i,rebuild) {\r\n\t\tif (i>doc.lineCount())return;\r\n\t\tvar M=doc.findMarks({line:i,ch:0},{line:i,ch:65536});\r\n\t\tM.forEach(function(m){m.clear()});\r\n\t\tvar line=doc.getLine(i);\r\n\t\tvar dirty=false;\r\n\t\tline.replace(/~(\\d+\\.\\d+)/g,function(m,pg,idx){\r\n\t\t\tvar element=createMarker(\"pbmarker\",pg);\r\n\t\t\tvar marker=doc.markText({line:i,ch:idx},{line:i,ch:idx+m.length},\r\n\t\t\t\t{clearOnEnter:true,replacedWith:element});\r\n\t\t\telement.marker=marker;\r\n\t\t});\r\n\r\n\t\tline.replace(/\\^([0-9.]+)/g,function(m,m1,idx){\r\n\t\t\tvar element=createMarker(\"paragraph\",m1);\r\n\t\t\tvar marker=doc.markText({line:i,ch:idx},{line:i,ch:idx+m.length},\r\n\t\t\t\t{clearOnEnter:true,replacedWith:element});\r\n\t\t\telement.marker=marker;\r\n\t\t});\r\n\r\n\t\tline.replace(/#(\\d+)\\.(\\d+)/g,function(m,m1,m2,idx){\r\n\t\t\tvar element=createMarker(\"footnote\",m1+\".\"+m2);\r\n\t\t\tvar marker=doc.markText({line:i,ch:idx},{line:i,ch:idx+m.length},\r\n\t\t\t\t{clearOnEnter:true,replacedWith:element});\r\n\t\t\telement.marker=marker;\r\n\t\t});\r\n\r\n\r\n\r\n\t\tsetTimeout(function(){\r\n\t\t\tif (rebuild && dirty) buildPBLINE();\r\n\t\t},100);//<pb id=\"1.2b\"/>\r\n\t}\r\n\r\nvar markAllLine=function() {\r\n\tvar M=doc.getAllMarks();\r\n\tM.forEach(function(m){m.clear()});\r\n\tfor (var i=0;i<doc.lineCount();i++){\r\n\t\tmarkLine(i);\r\n\t}\r\n\tbuildPBLINE();\r\n}\r\nvar prevpageid=function(pageid){\r\n\tvar m=pageid.match(/(\\d+)\\.(\\d+)/);\r\n\tif (!m) return pageid;\r\n\treturn (parseInt(m[2])-1);\r\n}\r\nvar buildPBLINE=function() {\r\n\t\t//var t=new Date();\r\n\t\tvar marks=doc.getAllMarks();\r\n\t\tif (!marks.length)return;\r\n\t\tPBLINE=[];\r\n\t\tfor (var i=0;i<marks.length;i++) {\r\n\t\t\tvar m=marks[i];\r\n\t\t\tif (m.replacedWith.className==\"pbmarker\") {\r\n\t\t\t\tvar pos=m.find();\r\n\t\t\t\tPBLINE.push([pos.from.line,m.replacedWith.innerHTML]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tPBLINE.sort(function(a,b){\r\n\t\t\treturn a[0]-b[0];\r\n\t\t});\r\n\r\n\t\tif (PBLINE[0][0]>0) { //append previous PB\r\n\t\t\tPBLINE.unshift([1,prevpageid(PBLINE[0][1])]);\r\n\t\t}\r\n\t\t//console.log(\"rebuild pbline\",new Date()-t);\r\n\t}\r\nvar setDoc=function(_doc){\r\n\tdoc=_doc;\r\n}\r\nvar getPageByLine=function(line) {\r\n\tif (!PBLINE.length)return;\r\n\t\tfor (var i=1;i<PBLINE.length;i++) {\r\n\t\t\tvar pbline=PBLINE[i];\r\n\t\t\tif (pbline[0]>line) {\r\n\t\t\t\treturn PBLINE[i-1][1];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn PBLINE[PBLINE.length-1][1];//default\r\n}\r\n\r\n\r\nvar setHotkeys=function(cm){\r\n\t\tcm.setOption(\"extraKeys\", {\r\n\t  \t\"Ctrl-S\": function(cm) {\r\n\t  \t\taction(\"savefile\");\r\n\t  \t}\r\n\t  });\r\n}\r\nconst onBeforeChange=function(){\r\n\r\n}\r\nconst validateMark=function(){\r\n\r\n}\r\nconst getFootnote=function(){\r\n\r\n}\r\nvar helpmessage=\"#footnote, ^paragraph\";\r\nmodule.exports={markAllLine,markLine,initpage,setDoc,onBeforeChange,validateMark\r\n,getPageByLine,init,setHotkeys,helpmessage,getPDFPage,getFootnote};",
    "var {store,action,getter,hasGetter,registerGetter,unregisterGetter}=require(\"./model\");\r\nvar fs=require(\"./socketfs\");\r\n\r\nvar fileio={\r\n\tinit:function(){\r\n\t\t//store.listen(\"load\",this.load,this);\r\n\t\tregisterGetter(\"file\",this.getfile);\r\n\t\tregisterGetter(\"save\",this.savefile);\r\n\t}\r\n\t,savefile:function({fn,content},cb){\r\n\t\tconsole.log(\"saving\",fn);\r\n\t\tfs.writeFile(fn,content,function(err){\r\n\t\t\tcb(err);\r\n\t\t});\r\n\t}\r\n\t,getfile:function(fn,cb){\r\n\t\tconsole.log(\"loading\",fn);\r\n\t\tconst bom=new RegExp(String.fromCharCode(0xFEFF),\"g\");\r\n\t\tfs.readFile(fn,function(err,data){\r\n\t\t\tif (!err) cb(data.replace(bom,\"\"));\r\n\t\t});\r\n\t}\r\n}\r\nmodule.exports=fileio;",
    "var setRule=require(\"./rule\").setRule;\r\nvar PDFViewer=require(\"./pdfviewer\");\r\nvar fileio=require(\"./fileio\");\r\nvar socketfs=require(\"./socketfs\");\r\nvar model=require(\"./model\");\r\nmodule.exports={setRule,PDFViewer,model,socketfs,fileio};",
    "/* action dispatcher */\r\nvar listeners=[];\r\nvar getters={};\r\n\r\nvar eventqueue=[];\r\nvar running=false;\r\n\r\nvar fireEvent=function(){\r\n\tif (eventqueue.length===0) {\r\n\t\trunning=false;\r\n\t\treturn;\r\n\t}\r\n\trunning=true;\r\n\r\n\tvar task=eventqueue.pop();\r\n\tvar func=task[0], opts=task[1], cb=task[2], context=task[3];\r\n\r\n\tif (func.length>1){\r\n\t\tfunc.call(context,opts,function(err,res,res2){\r\n\t\t\tcb&&cb(err,res,res2);\r\n\t\t\tsetTimeout(fireEvent,0);\r\n\t\t});\r\n\t} else { //sync func\r\n\t\tfunc.call(context,opts);\r\n\t\tsetTimeout(fireEvent,0);\r\n\t}\r\n}\r\n\r\nvar queueTask=function(func,opts,cb,context) {\r\n\teventqueue.unshift([func,opts,cb,context]);\r\n\tif (!running) setTimeout(fireEvent,0);\r\n}\r\n\r\nvar action=function(evt,opts,cb){\r\n\tfor (var i=0;i<listeners.length;i+=1) {\r\n\t\tvar listener=listeners[i];\r\n\t\tif (evt===listener[1] ) {\r\n\t\t\tif (listener[2]==undefined) {\r\n\t\t\t\tconsole.error(\"action has no callback\",evt,listener);\r\n\t\t\t}\r\n\t\t\tqueueTask( listener[2], opts,cb  , listener[0]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar getter=function(name,opts,cb){ // sync getter\r\n\tif (getters[name]) {\r\n\t\treturn getters[name](opts,cb);\r\n\t} else {\r\n\t\tconsole.error(\"getter '\"+name +\"' not found\");\r\n\t}\r\n}\r\nvar hasGetter=function(name) {\r\n\treturn (!!getters[name]);\r\n}\r\nvar registerGetter=function(name,cb,opts){\r\n\topts=opts||{};\r\n\tif (!cb && name) delete getters[name];\r\n\telse {\r\n\t\tif (getters[name] && !opts.overwrite) {\r\n\t\t\tconsole.error(\"getter name \"+name+\" overwrite.\");\r\n\t\t}\r\n\t\tgetters[name]=cb;\r\n\t} \r\n}\r\nvar unregisterGetter=function(name) {\r\n\tregisterGetter(name);\r\n}\r\n\r\nvar\tlisten=function(event,cb,element){\r\n\tlisteners.push([element,event,cb]);\r\n}\r\nvar unlistenAll=function(element){\r\n\tif (!element) {\r\n\t\tconsole.error(\"unlistenAll should specify this\")\r\n\t}\r\n\tlisteners=listeners.filter(function(listener){\r\n\t\treturn (listener[0]!==element) ;\r\n\t});\r\n}\r\n\r\nmodule.exports={ action, listen, unlistenAll, getter, registerGetter, unregisterGetter, hasGetter};",
    "/**\n\tread all ktx files and return meta json\n*/\nvar fs=require(\"fs\");\nvar readdirmeta=function(dataroot,path,cb){\n\n\tvar files=fs.readdirSync(dataroot+path);\n\tif (!files) {\n\t\tcb(\"cannot readdir\");\n\t\treturn ;\n\t}\n\n\ttry {\n\t\tvar out=files.map(function(file){\n\t\t\tvar fullname=dataroot+path+'/'+file;\n\t\t\tvar stat=fs.statSync(fullname);\n\t\t\tvar f=fs.openSync(fullname,\"r\");\n\t\t\tvar buffer = new Buffer(16*1024); //header should less than 16K\n\n\t\t\tfs.readSync(f,buffer,0,16*1024,0);\n\t\t\tvar s=buffer.toString(\"utf8\");\n\t\t\tvar idx=s.indexOf(\"\\n\");\n\t\t\ttry {\n\t\t\t\tvar firstline=s.substr(0,idx).trim();\n\t\t\t\tif (firstline[0]===\"[\") {\n\t\t\t\t\tfirstline=firstline.substr(1); //for ktx\n\t\t\t\t\tvar last=firstline[firstline.length-1];\n\t\t\t\t\tif (last!==\"}\") firstline=firstline.substr(0,firstline.length-1);\n\t\t\t\t}\n\t\t\t\tvar meta=JSON.parse(firstline);\n\t\t\t} catch (e) {\n\t\t\t\tmeta={title:file.substr(0,file.lastIndexOf(\".\"))};\n\t\t\t}\n\t\t\tfs.closeSync(f);\n\t\t\tmeta.filename=path+'/'+file;\n\t\t\tmeta.stat=stat;\n\t\t\treturn meta;\n\t\t});\n\t} catch(e) {\n\t\t\tconsole.log(e);\n\t}\n\tsetTimeout(function(){\n\t\tcb(0,out);\n\t},10);//wait for nw \n}\nmodule.exports=readdirmeta;",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nvar PDF = require(\"./react-pdf\");\r\nvar E=React.createElement;\r\nvar styles={\r\n\tcontainer:{\r\n\t\tfloat:\"left\",overflow:\"hidden\", \r\n\t}\r\n}\r\nvar PDFViewer = React.createClass({\r\n  render: function() {\r\n  \tif (this.props.rwidth) {\r\n      styles.container.width=(window.innerWidth*(this.props.rwidth||0.5))+\"px\";\r\n      styles.container.height=window.innerHeight;\r\n    }\r\n    \r\n    if (this.props.rheight) {\r\n      styles.container.height=(window.innerHeight*(this.props.rheight||0.5))+\"px\";\r\n      styles.container.width=window.innerWidth;\r\n    }\r\n\r\n\r\n\r\n  \tif (!this.props.pdffn) return E(\"div\",{style:{width:\"100%\"}},\"\");\r\n  \treturn E(\"div\",{style:styles.container},\r\n    \tE(PDF,{file:this.props.pdffn, scale:this.props.scale||1.4, left:-140,top:-150,\r\n    \tpage:parseInt(this.props.page)})\r\n    \t);\r\n  },\r\n  _onPdfCompleted: function(page, pages){\r\n    //this.setState({page: page, pages: pages});\r\n  }\r\n});\r\nmodule.exports=PDFViewer;",
    "/*\r\nfrom https://github.com/nnarhinen/react-pdf/blob/master/index.js\r\nadding big canvas scroll inside div \r\nhttp://stackoverflow.com/questions/16128604/scrollable-canvas-inside-div\r\n\r\n*/\r\nvar React = require('react');\r\nvar ReactDOM = require('react-dom');\r\n\r\nvar Pdf = React.createClass({\r\n  displayName: 'React-PDF',\r\n  propTypes: {\r\n    file: React.PropTypes.string,\r\n    content: React.PropTypes.string,\r\n    page: React.PropTypes.number,\r\n    scale: React.PropTypes.number,\r\n    onDocumentComplete: React.PropTypes.func,\r\n    onPageComplete: React.PropTypes.func\r\n  },\r\n  getInitialState: function() {\r\n    this.marginLeft=this.props.marginLeft||0;\r\n    this.marginTop=this.props.marginTop||0;\r\n    return { scale:this.props.scale};\r\n  },\r\n  getDefaultProps: function() {\r\n    return {page: 1, scale: 1.0};\r\n  },\r\n  componentDidMount: function() {\r\n    this._loadPDFDocument(this.props);\r\n  },\r\n  _loadByteArray: function(byteArray) {\r\n    PDFJS.getDocument(byteArray).then(this._onDocumentComplete);\r\n  },\r\n  _loadPDFDocument: function(props) {\r\n    if(!!props.file){\r\n      if (typeof props.file === 'string') return PDFJS.getDocument(props.file).then(this._onDocumentComplete);\r\n      // Is a File object\r\n      var reader = new FileReader(), self = this;\r\n      reader.onloadend = function() {\r\n        self._loadByteArray(new Uint8Array(reader.result));\r\n      };\r\n      reader.readAsArrayBuffer(props.file);\r\n    }\r\n    else if(!!props.content){\r\n      var bytes = window.atob(props.content);\r\n      var byteLength = bytes.length;\r\n      var byteArray = new Uint8Array(new ArrayBuffer(byteLength));\r\n      for(index = 0; index < byteLength; index++) {\r\n        byteArray[index] = bytes.charCodeAt(index);\r\n      }\r\n      this._loadByteArray(byteArray);\r\n    }\r\n    else {\r\n      console.error('React_Pdf works with a file(URL) or (base64)content. At least one needs to be provided!');\r\n    }\r\n  },\r\n  componentWillReceiveProps: function(newProps) {\r\n    if ((newProps.file && newProps.file !== this.props.file) || (newProps.content && newProps.content !== this.props.content)) {\r\n      this._loadPDFDocument(newProps);\r\n    }\r\n    if (!!this.state.pdf && !!newProps.page && newProps.page !== this.props.page) {\r\n      this.setState({page: null});\r\n      this.state.pdf.getPage(newProps.page).then(this._onPageComplete);\r\n    }\r\n  },\r\n  render: function() {\r\n    var self = this;\r\n\r\n    if (!!this.state.page){\r\n      setTimeout(function() {\r\n        if(self.isMounted()){\r\n          var canvas = ReactDOM.findDOMNode(self.refs.pdfCanvas),\r\n            context = canvas.getContext('2d'),\r\n            scale = self.state.scale,\r\n            viewport = self.state.page.getViewport(scale);\r\n          canvas.height = viewport.height;\r\n          canvas.width = viewport.width;\r\n\r\n          canvas.style.marginLeft = self.marginLeft+ \"px\";\r\n          canvas.style.marginTop = self.marginTop + \"px\";\r\n\r\n          var renderContext = {\r\n            canvasContext: context,\r\n            viewport: viewport\r\n          };\r\n          self.state.page.render(renderContext);\r\n        }\r\n      });\r\n      return (React.createElement(\"canvas\", {\r\n        onMouseDown:this.onMouseDown,\r\n        onMouseMove:this.onMouseMove,\r\n        onMouseUp:this.onMouseUp,\r\n        onWheel:this.onWheel,\r\n        ref: \"pdfCanvas\"}));\r\n    }\r\n    return (this.props.loading || React.createElement(\"div\", null, \"Loading pdf....\"));\r\n  },\r\n  lastX:0,\r\n  lastY:0,\r\n  toscale:0,\r\n  marginLeft:0,\r\n  marginTop:0,\r\n  rescale:function(){\r\n    //todo , ajdust margin left right when rescale\r\n    var s=this.toscale/10;\r\n    var scale=this.state.scale+s;\r\n    if (scale<0.5 )scale=0.5;\r\n    if (scale>3) scale=3;\r\n\r\n    this.marginLeft+=(s*this.marginLeft);\r\n    this.marginTop+=(s*this.marginTop);\r\n    this.toscale=0;\r\n    this.setState({scale});\r\n  }\r\n  ,onWheel:function(e){\r\n    var m=-(e.deltaY/200);\r\n    this.toscale+=m;\r\n    clearTimeout(this.scaletimer);\r\n    this.scaletimer=setTimeout(function(){\r\n      this.rescale();\r\n    }.bind(this),300);\r\n  },\r\n  onMouseMove:function(e){\r\n    if (this.dragging) {\r\n        var canvas = ReactDOM.findDOMNode(this.refs.pdfCanvas);\r\n        var xdelta = e.clientX - this.lastX;\r\n        var ydelta = e.clientY - this.lastY;\r\n        this.lastX = e.clientX;\r\n        this.lastY = e.clientY;\r\n        this.marginLeft += xdelta;\r\n        this.marginTop += ydelta;\r\n        canvas.style.marginLeft = this.marginLeft + \"px\";\r\n        canvas.style.marginTop = this.marginTop + \"px\";\r\n    }\r\n    e.preventDefault();\r\n  },\r\n  onMouseDown:function(e){\r\n    this.dragging = true;\r\n    this.lastX = e.clientX;\r\n    this.lastY = e.clientY;\r\n    e.preventDefault();\r\n  }, \r\n  onMouseUp:function(){\r\n     this.dragging = false;\r\n  },\r\n  _onDocumentComplete: function(pdf){\r\n    if (!this.isMounted()) return;\r\n    this.setState({ pdf: pdf });\r\n    if(!!this.props.onDocumentComplete && typeof this.props.onDocumentComplete === 'function'){\r\n      this.props.onDocumentComplete(pdf.numPages);\r\n    }\r\n    pdf.getPage(this.props.page).then(this._onPageComplete);\r\n  },\r\n  _onPageComplete: function(page){\r\n    if (!this.isMounted()) return;\r\n    this.setState({ page: page });\r\n    if(!!this.props.onPageComplete && typeof this.props.onPageComplete === 'function'){\r\n      this.props.onPageComplete(page.pageIndex + 1);\r\n    }\r\n  }\r\n});\r\n\r\nmodule.exports = Pdf;\r\n",
    "/*\n\tthis is for browser, a simple wrapper for socket.io rpc\n\t\n\tfor each call to server, create a unique id\n\twhen server return, get the slot by unique id, and invoke callbacks.\n*/\n(function(){\n\nif (typeof io==\"undefined\") {\n\tmodule.exports=window.host={exec:function(){console.log(\"NO RPC\")}}; \n\treturn;\n}\nfunction GUID () {\n  var S4 = function ()    {    return Math.floor(        Math.random() * 0x10000  ).toString(16);  };\n  return (   S4() + S4() + \"-\" + S4() + \"-\" +  S4() + \"-\" + S4() + \"-\" +S4() + S4() + S4()    );\n}\n\nvar RPCs={}; //*  key: unique calling id  */\n\nvar socket = io.connect(window.location.host);\n\nvar returnfromserver=function(res) {\n\tvar slot=RPCs[res.fid];\n\t\n\tif (!slot) {\n\t\tthrow \"invalid fid \"+res.fid;\n\t\treturn;\n\t}\n\t\n\tif (res.success) {\n\t\tif (slot.successCB)  slot.successCB(res.err,res.response);\n\t} else {\n\t\tif (slot.errorCB)  slot.errorCB(res.err,res.response);\n\t}\n\tdelete RPCs[res.fid]; //drop the slot\n}\n\nvar pchost={\n\trpchost:true\n\t,exec: function(successCB, errorCB, service, action, params) {\n\t\tvar fid=GUID();\n\t\t//create a slot to hold\n\t\tvar slot={  fid:fid, successCB:successCB, errorCB:errorCB ,params:params, action:action, service:service};\n\t\tRPCs[fid]=slot;\n\t\tsocket.emit('rpc',  { service: service, action:action, params: params , fid:fid });\n\t}\n}\n\nsocket.on( 'rpc', returnfromserver );\t \nwindow.host=pchost;\nmodule.exports=pchost;\n\n})();",
    "var host=require(\"./rpc\");\n\nvar makeinf=function(name) {\n\treturn (\n\t\tfunction(opts,callback) {\n\t\t\thost.exec(callback,0,\"fs\",name,opts);\n\t\t});\n}\n\nvar API={};\n//TODO , create a cache object on client side to save network trafic on\n//same getRaw\nAPI.readFile=makeinf(\"readFile\");\nAPI.writeFile=makeinf(\"writeFile\");\nAPI.exists=makeinf(\"exists\");\nAPI.unlink=makeinf(\"unlink\");\nAPI.mkdir=makeinf(\"mkdir\");\nAPI.readdir=makeinf(\"readdir\");\n\n\n//API.closeAll=makeinf(\"closeAll\");\n//exports.version='0.0.13'; //this is a quick hack\n\n\nmodule.exports=API;",
    "var host=require(\"./rpc\");\n\nvar makeinf=function(name) {\n\treturn (\n\t\tfunction(opts,callback) {\n\t\t\thost.exec(callback,0,\"util\",name,opts);\n\t\t});\n}\n\nvar API={};\n//TODO , create a cache object on client side to save network trafic on\n//same getRaw\nAPI.readdirmeta=makeinf(\"readdirmeta\");\n\nhost.exec(function(err,data){\n\t//console.log('version',err,data)\n\texports.version=data;\n},0,\"util\",\"version\",{});\n\n\nmodule.exports=API;",
    "var {store,action,getter,hasGetter,registerGetter,unregisterGetter}=require(\"./model\");\r\n\r\nvar rule={\r\n\tsetRule:function(_rule){\r\n\t\tthis.rule=_rule;\r\n\t\tif (_rule.init) _rule.init();\r\n\t\tunregisterGetter(\"automark\");\r\n\t\tregisterGetter(\"automark\",_rule.automark);\r\n\t}\r\n};\r\nmodule.exports=rule;",
    "var fs=(typeof process!==\"undefined\")?require(\"fs\"):{}; // webpack.config.js node:{    fs:\"empty\" }\nif (typeof fs.readFile==\"undefined\") {\n\tvar rpcfs=require(\"./rpc/rpc_fs\");\t\n\tvar rpcutil=require(\"./rpc/rpc_util\");\t\n}\nvar dataroot=\"\";\nvar setDataroot=function(_dataroot){\n\tdataroot=_dataroot;\n}\nvar ready=function() {\n\tif (fs.readFile) return true;\n\tif (window.host.rpchost) return true;\n\treturn false;\n}\nvar readFile=function(fn,opts,cb) {\n\n\tif (fs.readFile) {\n\t\tif (typeof opts===\"function\") {\n\t\t\tcb=opts;\n\t\t\topts=\"utf8\";\n\t\t}\n\t\tfs.readFile(\"../\"+dataroot+fn,opts,cb);\n\t} else {\n\t\tif (typeof opts===\"function\") {\n\t\t\tcb=opts;\n\t\t\topts=null;\n\t\t}\n\t\trpcfs.readFile({filename:dataroot+fn,opts:opts},cb);\n\t}\n}\nvar writeFile=function(fn,data,opts,cb) {\n\tif (fs.writeFile) {\n\t\tif (typeof opts===\"function\") {\n\t\t\tcb=opts;\n\t\t\topts=\"utf8\";\n\t\t}\n\t\tfs.writeFile(\"../\"+dataroot+fn,data,opts,cb);\n\t} else {\n\t\tif (typeof opts===\"function\") {\n\t\t\tcb=opts;\n\t\t\topts=null;\n\t\t}\n\t\trpcfs.writeFile({filename:dataroot+fn,opts:opts,data:data},cb);\n\t}\n}\nvar exists=function(fn,cb){\n\tif (fs.exists) fs.exists(dataroot+fn,cb);\n\telse {\n\t\trpcfs.exists({filename:dataroot+fn},cb);\n\t}\n}\n\nvar unlink=function(fn,cb){\n\tif (fs.unlink) fs.unlink(dataroot+fn,cb);\n\telse {\n\t\trpcfs.unlink({filename:dataroot+fn},cb);\n\t}\n}\nvar mkdir=function(path,mode,cb) {\n\tif (fs.mkdir) fs.mkdir(dataroot+path,cb);\n\telse {\n\t\tif (typeof mode===\"function\") {\n\t\t\tcb=mode;\n\t\t\tmode=null;\n\t\t}\n\t\trpcfs.mkdir({path:dataroot+path,mode:mode},cb);\n\t}\n}\nvar readdir=function(path,cb) {\n\tif (fs.readdir) fs.readdir(dataroot+path,cb);\n\telse {\n\t\trpcfs.readdir({path:dataroot+path},cb);\n\t}\n}\n\nvar readdirmeta=function(path,cb) {//read all meta in given path\n\tif (fs.readdir) {\n\t\trequire(\"./node/readdirmeta\")(dataroot,path,cb);\n\t} else {\n\t\trpcutil.readdirmeta({dataroot:dataroot,path:path},cb);\n\t}\n\n}\nmodule.exports={readFile:readFile,writeFile:writeFile,exists:exists,setDataroot,\n\tunlink:unlink,mkdir:mkdir,readdir:readdir,readdirmeta:readdirmeta,ready:ready};",
    "\r\nvar userCancel=false;\r\nvar files=[];\r\nvar totalDownloadByte=0;\r\nvar targetPath=\"\";\r\nvar tempPath=\"\";\r\nvar nfile=0;\r\nvar baseurl=\"\";\r\nvar result=\"\";\r\nvar downloading=false;\r\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\r\n\tvar fs     = require(\"fs\");\r\n\tvar path   = require(\"path\");\r\n\r\n\t\r\n\tfiles=_files.split(\"\\uffff\");\r\n\tif (downloading) return false; //only one session\r\n\tuserCancel=false;\r\n\ttotalDownloadByte=0;\r\n\tnextFile();\r\n\tdownloading=true;\r\n\tbaseurl=_baseurl;\r\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\r\n\ttargetPath=ksanagap.rootPath+dbid+'/';\r\n\ttempPath=ksanagap.rootPath+\".tmp/\";\r\n\tresult=\"\";\r\n\treturn true;\r\n}\r\n\r\nvar nextFile=function() {\r\n\tsetTimeout(function(){\r\n\t\tif (nfile==files.length) {\r\n\t\t\tnfile++;\r\n\t\t\tendDownload();\r\n\t\t} else {\r\n\t\t\tdownloadFile(nfile++);\t\r\n\t\t}\r\n\t},100);\r\n}\r\n\r\nvar downloadFile=function(nfile) {\r\n\tvar url=baseurl+files[nfile];\r\n\tvar tmpfilename=tempPath+files[nfile];\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\tvar fs     = require(\"fs\");\r\n\tvar http   = require(\"http\");\r\n\r\n\tmkdirp.sync(path.dirname(tmpfilename));\r\n\tvar writeStream = fs.createWriteStream(tmpfilename);\r\n\tvar datalength=0;\r\n\tvar request = http.get(url, function(response) {\r\n\t\tresponse.on('data',function(chunk){\r\n\t\t\twriteStream.write(chunk);\r\n\t\t\ttotalDownloadByte+=chunk.length;\r\n\t\t\tif (userCancel) {\r\n\t\t\t\twriteStream.end();\r\n\t\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t\t}\r\n\t\t});\r\n\t\tresponse.on(\"end\",function() {\r\n\t\t\twriteStream.end();\r\n\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nvar cancelDownload=function() {\r\n\tuserCancel=true;\r\n\tendDownload();\r\n}\r\nvar verify=function() {\r\n\treturn true;\r\n}\r\nvar endDownload=function() {\r\n\tnfile=files.length+1;//stop\r\n\tresult=\"cancelled\";\r\n\tdownloading=false;\r\n\tif (userCancel) return;\r\n\tvar fs     = require(\"fs\");\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\r\n\tfor (var i=0;i<files.length;i++) {\r\n\t\tvar targetfilename=targetPath+files[i];\r\n\t\tvar tmpfilename   =tempPath+files[i];\r\n\t\tmkdirp.sync(path.dirname(targetfilename));\r\n\t\tfs.renameSync(tmpfilename,targetfilename);\r\n\t}\r\n\tif (verify()) {\r\n\t\tresult=\"success\";\r\n\t} else {\r\n\t\tresult=\"error\";\r\n\t}\r\n}\r\n\r\nvar downloadedByte=function() {\r\n\treturn totalDownloadByte;\r\n}\r\nvar doneDownload=function() {\r\n\tif (nfile>files.length) return result;\r\n\telse return \"\";\r\n}\r\nvar downloadingFile=function() {\r\n\treturn nfile-1;\r\n}\r\n\r\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\r\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\r\nmodule.exports=downloader;",
    "/* emulate filesystem on html5 browser */\r\nvar get_head=function(url,field,cb){\r\n\tvar xhr = new XMLHttpRequest();\r\n\txhr.open(\"HEAD\", url, true);\r\n\txhr.onreadystatechange = function() {\r\n\t\t\tif (this.readyState == this.DONE) {\r\n\t\t\t\tcb(xhr.getResponseHeader(field));\r\n\t\t\t} else {\r\n\t\t\t\tif (this.status!==200&&this.status!==206) {\r\n\t\t\t\t\tcb(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t};\r\n\txhr.send();\r\n}\r\nvar get_date=function(url,cb) {\r\n\tget_head(url,\"Last-Modified\",function(value){\r\n\t\tcb(value);\r\n\t});\r\n}\r\nvar get_size=function(url, cb) {\r\n\tget_head(url,\"Content-Length\",function(value){\r\n\t\tcb(parseInt(value));\r\n\t});\r\n};\r\nvar checkUpdate=function(url,fn,cb) {\r\n\tif (!url) {\r\n\t\tcb(false);\r\n\t\treturn;\r\n\t}\r\n\tget_date(url,function(d){\r\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\r\n\t\t\tfileEntry.getMetadata(function(metadata){\r\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\r\n\t\t\t\tvar urlDate=Date.parse(d);\r\n\t\t\t\tcb(urlDate>localDate);\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tcb(false);\r\n\t\t});\r\n\t});\r\n}\r\nvar download=function(url,fn,cb,statuscb,context) {\r\n\t var totalsize=0,batches=null,written=0;\r\n\t var fileEntry=0, fileWriter=0;\r\n\t var createBatches=function(size) {\r\n\t\tvar bytes=1024*1024, out=[];\r\n\t\tvar b=Math.floor(size / bytes);\r\n\t\tvar last=size %bytes;\r\n\t\tfor (var i=0;i<=b;i++) {\r\n\t\t\tout.push(i*bytes);\r\n\t\t}\r\n\t\tout.push(b*bytes+last);\r\n\t\treturn out;\r\n\t }\r\n\t var finish=function() {\r\n\t\t rm(fn,function(){\r\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\r\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t},function(e){\r\n\t\t\t\t\tconsole.log(\"failed\",e)\r\n\t\t\t\t});\r\n\t\t },this);\r\n\t };\r\n\t\tvar tempfn=\"temp.kdb\";\r\n\t\tvar batch=function(b) {\r\n\t\tvar abort=false;\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\tvar requesturl=url+\"?\"+Math.random();\r\n\t\txhr.open('get', requesturl, true);\r\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.addEventListener('load', function() {\r\n\t\t\tvar blob=this.response;\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\tfileWriter.seek(fileWriter.length);\r\n\t\t\t\tfileWriter.write(blob);\r\n\t\t\t\twritten+=blob.size;\r\n\t\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\t\tif (statuscb) {\r\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\r\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t \t}\r\n\t\t\t\t\tb++;\r\n\t\t\t\t\tif (!abort) {\r\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\r\n\t\t\t\t\t\telse                    finish();\r\n\t\t\t\t \t}\r\n\t\t\t \t};\r\n\t\t\t}, console.error);\r\n\t\t},false);\r\n\t\txhr.send();\r\n\t}\r\n\r\n\tget_size(url,function(size){\r\n\t\ttotalsize=size;\r\n\t\tif (!size) {\r\n\t\t\tif (cb) cb.apply(context,[false]);\r\n\t\t} else {//ready to download\r\n\t\t\trm(tempfn,function(){\r\n\t\t\t\t batches=createBatches(size);\r\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\r\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\r\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\r\n\t\t\t\t\t\tbatch(0);\r\n\t\t\t\t });\r\n\t\t\t},this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar readFile=function(filename,cb,context) {\r\n\tAPI.fs.root.getFile(filename, {create: false, exclusive: false},function(fileEntry) {\r\n\t\tfileEntry.file(function(file){\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onloadend = function(e) {\r\n\t\t\t\tif (cb) cb.call(cb,this.result);\r\n\t\t\t};\r\n\t\t\treader.readAsText(file,\"utf8\");\r\n\t\t});\r\n\t}, console.error);\r\n}\r\n\r\nfunction createDir(rootDirEntry, folders,  cb) {\r\n  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.\r\n  if (folders[0] == '.' || folders[0] == '') {\r\n    folders = folders.slice(1);\r\n  }\r\n  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {\r\n    // Recursively add the new subfolder (if we still have another to create).\r\n    if (folders.length) {\r\n      createDir(dirEntry, folders.slice(1),cb);\r\n    } else {\r\n\t\t\tcb();\r\n\t\t}\r\n  }, cb);\r\n};\r\n\r\n\r\nvar writeFile=function(filename,buf,cb,context){\r\n\tvar write=function(fileEntry){\r\n\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\tfileWriter.write(buf);\r\n\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\r\n\t\t\t};\r\n\t\t}, console.error);\r\n\t}\r\n\r\n\tvar getFile=function(filename){\r\n\t\tAPI.fs.root.getFile(filename, {exclusive:true}, function(fileEntry) {\r\n\t\t\twrite(fileEntry);\r\n\t\t}, function(){\r\n\t\t\t\tAPI.fs.root.getFile(filename, {create:true,exclusive:true}, function(fileEntry) {\r\n\t\t\t\t\twrite(fileEntry);\r\n\t\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\tvar slash=filename.lastIndexOf(\"/\");\r\n\tif (slash>-1) {\r\n\t\tcreateDir(API.fs.root, filename.substr(0,slash).split(\"/\"),function(){\r\n\t\t\tgetFile(filename);\r\n\t\t});\r\n\t} else {\r\n\t\tgetFile(filename);\r\n\t}\r\n}\r\n\r\nvar readdir=function(cb,context) {\r\n\tvar dirReader = API.fs.root.createReader();\r\n\tvar out=[],that=this;\r\n\tdirReader.readEntries(function(entries) {\r\n\t\tif (entries.length) {\r\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\r\n\t\t\t\tif (entry.isFile) {\r\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tAPI.files=out;\r\n\t\tif (cb) cb.apply(context,[out]);\r\n\t}, function(){\r\n\t\tif (cb) cb.apply(context,[null]);\r\n\t});\r\n}\r\nvar getFileURL=function(filename) {\r\n\tif (!API.files ) return null;\r\n\tvar file= API.files.filter(function(f){return f[0]==filename});\r\n\tif (file.length) return file[0][1];\r\n}\r\nvar rm=function(filename,cb,context) {\r\n\tvar url=getFileURL(filename);\r\n\tif (url) rmURL(url,cb,context);\r\n\telse if (cb) cb.apply(context,[false]);\r\n}\r\n\r\nvar rmURL=function(filename,cb,context) {\r\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\r\n\t\tfileEntry.remove(function() {\r\n\t\t\tif (cb) cb.apply(context,[true]);\r\n\t\t}, console.error);\r\n\t},  function(e){\r\n\t\tif (cb) cb.apply(context,[false]);//no such file\r\n\t});\r\n}\r\nfunction errorHandler(e) {\r\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\r\n}\r\nvar initfs=function(grantedBytes,cb,context) {\r\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\r\n\t\tAPI.fs=fs;\r\n\t\tAPI.quota=grantedBytes;\r\n\t\treaddir(function(){\r\n\t\t\tAPI.initialized=true;\r\n\t\t\tcb.apply(context,[grantedBytes,fs]);\r\n\t\t},context);\r\n\t}, errorHandler);\r\n}\r\nvar init=function(quota,cb,context) {\r\n\tif (!navigator.webkitPersistentStorage) return;\r\n\tnavigator.webkitPersistentStorage.requestQuota(quota,\r\n\t\t\tfunction(grantedBytes) {\r\n\t\t\t\tinitfs(grantedBytes,cb,context);\r\n\t\t}, errorHandler\r\n\t);\r\n}\r\nvar queryQuota=function(cb,context) {\r\n\tvar that=this;\r\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota(\r\n\t function(usage,quota){\r\n\t\t\tinitfs(quota,function(){\r\n\t\t\t\tcb.apply(context,[usage,quota]);\r\n\t\t\t},context);\r\n\t});\r\n}\r\nvar API={\r\n\tinit:init\r\n\t,readdir:readdir\r\n\t,checkUpdate:checkUpdate\r\n\t,rm:rm\r\n\t,rmURL:rmURL\r\n\t,getFileURL:getFileURL\r\n\t,writeFile:writeFile\r\n\t,readFile:readFile\r\n\t,download:download\r\n\t,get_head:get_head\r\n\t,get_date:get_date\r\n\t,get_size:get_size\r\n\t,getDownloadSize:get_size\r\n\t,queryQuota:queryQuota\r\n}\r\nmodule.exports=API;\r\n",
    "var appname=\"installer\";\r\nif (typeof ksana==\"undefined\") {\r\n\twindow.ksana={platform:\"chrome\"};\r\n\tif (typeof process!==\"undefined\" && \r\n\t\tprocess.versions && process.versions[\"node-webkit\"]) {\r\n\t\twindow.ksana.platform=\"node-webkit\";\r\n\t}\r\n}\r\nvar switchApp=function(path) {\r\n\tvar fs=require(\"fs\");\r\n\tpath=\"../\"+path;\r\n\tappname=path;\r\n\tdocument.location.href= path+\"/index.html\"; \r\n\tprocess.chdir(path);\r\n}\r\nvar downloader={};\r\nvar rootPath=\"\";\r\n\r\nvar deleteApp=function(app) {\r\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\r\n}\r\nvar username=function() {\r\n\treturn \"\";\r\n}\r\nvar useremail=function() {\r\n\treturn \"\"\r\n}\r\nvar runtime_version=function() {\r\n\treturn \"1.4\";\r\n}\r\n\r\n//copy from liveupdate\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp2\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    if (typeof data==\"object\") {\r\n      data.dbid=dbid;\r\n      callback.apply(context,[data]);    \r\n    }  \r\n  }\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp2\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\n\r\n\r\nvar loadKsanajs=function(){\r\n\r\n\tif (typeof process!=\"undefined\" && !process.browser) {\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\r\n\t\tdownloader=require(\"./downloader\");\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\trootPath=process.cwd();\r\n\t\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\r\n\t\tksana.ready=true;\r\n\t} else{\r\n\t\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\r\n\t\tjsonp(url,appname,function(data){\r\n\t\t\tksana.js=data;\r\n\t\t\tksana.ready=true;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nloadKsanajs();\r\n\r\nvar boot=function(appId,cb) {\r\n\tif (typeof appId==\"function\") {\r\n\t\tcb=appId;\r\n\t\tappId=\"unknownapp\";\r\n\t}\r\n\tif (!ksana.js && ksana.platform==\"node-webkit\") {\r\n\t\tloadKsanajs();\r\n\t}\r\n\tksana.appId=appId;\r\n\tif (ksana.ready) {\r\n\t\tcb();\r\n\t\treturn;\r\n\t}\r\n\tvar timer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t},100);\r\n}\r\n\r\n\r\nvar ksanagap={\r\n\tplatform:\"node-webkit\",\r\n\tstartDownload:downloader.startDownload,\r\n\tdownloadedByte:downloader.downloadedByte,\r\n\tdownloadingFile:downloader.downloadingFile,\r\n\tcancelDownload:downloader.cancelDownload,\r\n\tdoneDownload:downloader.doneDownload,\r\n\tswitchApp:switchApp,\r\n\trootPath:rootPath,\r\n\tdeleteApp: deleteApp,\r\n\tusername:username, //not support on PC\r\n\tuseremail:username,\r\n\truntime_version:runtime_version,\r\n\tboot:boot\r\n}\r\nmodule.exports=ksanagap;",
    "var started=false;\r\nvar timer=null;\r\nvar bundledate=null;\r\nvar get_date=require(\"./html5fs\").get_date;\r\nvar checkIfBundleUpdated=function() {\r\n\tget_date(\"bundle.js\",function(date){\r\n\t\tif (bundledate &&bundledate!=date){\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t\tbundledate=date;\r\n\t});\r\n}\r\nvar livereload=function() {\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")===-1) return;\r\n\r\n\tif (started) return;\r\n\r\n\ttimer1=setInterval(function(){\r\n\t\tcheckIfBundleUpdated();\r\n\t},2000);\r\n\tstarted=true;\r\n}\r\n\r\nmodule.exports=livereload;",
    "function mkdirP (p, mode, f, made) {\r\n     var path = nodeRequire('path');\r\n     var fs = nodeRequire('fs');\r\n\t\r\n    if (typeof mode === 'function' || mode === undefined) {\r\n        f = mode;\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    var cb = f || function () {};\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    fs.mkdir(p, mode, function (er) {\r\n        if (!er) {\r\n            made = made || p;\r\n            return cb(null, made);\r\n        }\r\n        switch (er.code) {\r\n            case 'ENOENT':\r\n                mkdirP(path.dirname(p), mode, function (er, made) {\r\n                    if (er) cb(er, made);\r\n                    else mkdirP(p, mode, cb, made);\r\n                });\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                fs.stat(p, function (er2, stat) {\r\n                    // if the stat fails, then that's super weird.\r\n                    // let the original error be the failure reason.\r\n                    if (er2 || !stat.isDirectory()) cb(er, made)\r\n                    else cb(null, made);\r\n                });\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nmkdirP.sync = function sync (p, mode, made) {\r\n    var path = nodeRequire('path');\r\n    var fs = nodeRequire('fs');\r\n    if (mode === undefined) {\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    try {\r\n        fs.mkdirSync(p, mode);\r\n        made = made || p;\r\n    }\r\n    catch (err0) {\r\n        switch (err0.code) {\r\n            case 'ENOENT' :\r\n                made = sync(path.dirname(p), mode, made);\r\n                sync(p, mode, made);\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                var stat;\r\n                try {\r\n                    stat = fs.statSync(p);\r\n                }\r\n                catch (err1) {\r\n                    throw err0;\r\n                }\r\n                if (!stat.isDirectory()) throw err0;\r\n                break;\r\n        }\r\n    }\r\n\r\n    return made;\r\n};\r\n\r\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\r\n"
  ]
}